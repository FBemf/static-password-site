<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="./sjcl.js" type="text/javascript"></script>
    <script type="text/javascript">
      const hiddenPage = "hidden.html";
      window.onload = function () {
        let before = document.getElementById("before");
        let after = document.getElementById("after");
        let incorrect = document.getElementById("incorrect");
        let passwordBox = document.getElementById("password");
        let submitButton = document.getElementById("submit");

        after.style.display = "none";

        passwordBox.addEventListener("keyup", (event) => {
          if (event.keyCode === 13) {
            event.preventDefault();
            submitButton.click();
          }
        });

        submitButton.addEventListener("click", async (event) => {
          event.preventDefault();
          let password = passwordBox.value;
          await fetch(hiddenPage + ".encrypted")
            .then(response => response.text())
            .then(data => {
              try {
                let decrypted = sjcl.decrypt(
                  password,
                  data);
                after.innerHTML = decrypted;
                before.style.display = "none";
                after.style.display = "";
              } catch (e) {
                incorrect.innerText = " [Incorrect] ";
              }
            });
        });
      }
    </script>
    <style type="text/css">
      body{
        margin: 40px auto;
        max-width: 650px;
        line-height: 1.6;
        font-size: 18px;
        color: #444;
        padding: 0 10px;
      }
      h1, h2, h3 {
        line-height: 1.2;
      }
    </style>
  </head>
  <body>
    <div id="before">
      <h1>Access Restricted</h1>
      <p>Please enter the password below.</p>
      <input type="password" id="password">
      <button id="submit">Submit</button>
      <span id="incorrect"></span>
    </div>
    <div id="after"></div>
  </body>
</html>
